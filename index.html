<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Saga Vuelve ‚Äî Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<style>
:root {
  --bg: #f4f5f7;
  --surface: #ffffff;
  --surface-2: #eef0f3;
  --border: #dde0e6;
  --text: #1a1d23;
  --text-dim: #6b7280;
  --accent: #d97706;
  --accent-glow: rgba(217, 119, 6, 0.1);
  --green: #16a34a;
  --red: #dc2626;
  --blue: #2563eb;
  --purple: #9333ea;
  --pink: #db2777;
  --ig: #C13584;
  --yt: #CC0000;
  --sp: #1DB954;
  --em: #2563eb;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  line-height: 1.5;
}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
  position: relative;
  padding: 40px 24px 32px;
  text-align: center;
  overflow: hidden;
  border-bottom: 1px solid var(--border);
}
.hero::before {
  content: '';
  position: absolute;
  top: -50%; left: -25%; width: 150%; height: 200%;
  background: radial-gradient(ellipse at 50% 0%, rgba(217,119,6,0.06) 0%, transparent 60%);
  pointer-events: none;
}
.hero-title {
  font-family: 'Sora', sans-serif;
  font-size: clamp(1.6rem, 5vw, 2.4rem);
  font-weight: 800;
  letter-spacing: -0.03em;
  background: linear-gradient(135deg, #d97706, #ea580c, #dc2626);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}
.hero-sub {
  font-family: 'Sora', sans-serif;
  color: var(--text-dim);
  font-size: 0.85rem;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}
.refresh-btn {
  margin-top: 12px;
  padding: 8px 20px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 8px;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  position: relative;
  transition: all 0.2s;
}
.refresh-btn:hover { background: #b45309; transform: translateY(-1px); }
.refresh-btn:active { transform: translateY(0); }
.refresh-btn.loading { opacity: 0.7; pointer-events: none; }
.refresh-btn.success { background: var(--green); }
.refresh-btn.error { background: var(--red); }
.countdown {
  display: inline-flex;
  align-items: baseline;
  gap: 6px;
  margin-top: 16px;
  padding: 10px 24px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 100px;
}
.countdown-num {
  font-family: 'Sora', sans-serif;
  font-size: 2rem;
  font-weight: 700;
  color: var(--accent);
}
.countdown-label {
  font-size: 0.8rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px 16px;
}
.grid {
  display: grid;
  gap: 16px;
  margin-bottom: 24px;
}
.grid-4 { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
.grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
.grid-3 { grid-template-columns: repeat(3, 1fr); }

/* ‚îÄ‚îÄ KPI CARDS ‚îÄ‚îÄ */
.kpi {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.kpi-hero {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px 24px;
  margin-bottom: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  text-align: center;
}
.kpi-hero::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--ig), var(--yt), var(--sp));
  opacity: 0.7;
}
.kpi-hero .kpi-value {
  font-size: 2.2rem;
}
.kpi-hero .tearoff {
  margin-left: -24px;
  margin-right: -24px;
  margin-bottom: -20px;
}
.kpi::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: var(--accent);
  opacity: 0.5;
}
.kpi-label {
  font-size: 0.7rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 6px;
  text-align: center;
}
.kpi-value {
  font-family: 'Sora', sans-serif;
  font-size: 1.5rem;
  font-weight: 700;
  letter-spacing: -0.02em;
  text-align: center;
}
.kpi-change {
  font-size: 0.75rem;
  margin-top: 4px;
}
.kpi-change.pos { color: var(--green); }
.kpi-change.neg { color: var(--red); }
.kpi-change.neutral { color: var(--text-dim); }

/* ‚îÄ‚îÄ PLATFORM TEAROFF TABS ‚îÄ‚îÄ */
.tearoff {
  display: flex;
  flex-wrap: wrap;
  gap: 2px;
  margin-top: 14px;
  margin-left: -16px;
  margin-right: -16px;
  margin-bottom: -16px;
}
.tearoff-tab {
  flex: 1 1 auto;
  min-width: 40px;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 6px 3px 8px;
  border-top: 2px dashed var(--border);
  position: relative;
  cursor: default;
  transition: background 0.2s;
}
.tearoff-tab:hover {
  background: rgba(0,0,0,0.02);
}
.tearoff-tab:first-child {
  border-bottom-left-radius: 11px;
}
.tearoff-tab:last-child {
  border-bottom-right-radius: 11px;
}
.tearoff-color {
  width: 100%;
  height: 7px;
  border-radius: 3px;
  margin-bottom: 6px;
}
.tearoff-val {
  font-family: 'Sora', sans-serif;
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--text);
  line-height: 1;
}
.tearoff-name {
  font-size: 0.6rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-top: 3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}
.kpi-detail {
  font-size: 0.65rem;
  color: var(--text-dim);
  margin-top: 6px;
  line-height: 1.3;
  letter-spacing: 0.02em;
}

/* ‚îÄ‚îÄ SECTION ‚îÄ‚îÄ */
.section {
  margin-bottom: 32px;
}
.section-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}
.section-icon {
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
  flex-shrink: 0;
}
.section-icon.ig { background: rgba(225,48,108,0.15); }
.section-icon.em { background: rgba(59,130,246,0.15); }
.section-icon.yt { background: rgba(255,0,0,0.12); }
.section-icon.sp { background: rgba(29,185,84,0.15); }
.section-icon.x { background: rgba(0,0,0,0.08); }
.section-icon.tk { background: rgba(0,0,0,0.08); }
.section-title {
  font-family: 'Sora', sans-serif;
  font-size: 1.1rem;
  font-weight: 600;
  letter-spacing: -0.01em;
}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.card-title {
  font-family: 'Sora', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 12px;
}

/* ‚îÄ‚îÄ METRICS ROW ‚îÄ‚îÄ */
.metric-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
}
.metric-row:last-child { border-bottom: none; }
.metric-name { font-size: 0.85rem; color: var(--text-dim); }
.metric-val {
  font-family: 'Sora', sans-serif;
  font-weight: 600;
  font-size: 0.95rem;
}

/* ‚îÄ‚îÄ CHART ‚îÄ‚îÄ */
.chart-wrap {
  position: relative;
  height: 200px;
  margin-top: 8px;
}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}
.data-table th {
  text-align: left;
  color: var(--text-dim);
  font-weight: 500;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: 8px 12px;
  border-bottom: 1px solid var(--border);
}
.data-table td {
  padding: 8px 12px;
  border-bottom: 1px solid var(--border);
}
.data-table tr:last-child td { border-bottom: none; }

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.progress {
  width: 100%;
  height: 6px;
  background: var(--surface-2);
  border-radius: 3px;
  overflow: hidden;
  margin-top: 8px;
}
.progress-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.5s ease;
}

/* ‚îÄ‚îÄ ALERT ‚îÄ‚îÄ */
.alert {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  background: rgba(220,38,38,0.06);
  border: 1px solid rgba(220,38,38,0.2);
  border-radius: 8px;
  font-size: 0.85rem;
  color: #991b1b;
  margin-bottom: 12px;
}

/* ‚îÄ‚îÄ TAG ‚îÄ‚îÄ */
.tag {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.tag-reel { background: rgba(147,51,234,0.1); color: #7c3aed; }
.tag-image { background: rgba(37,99,235,0.1); color: #1d4ed8; }
.tag-video { background: rgba(217,119,6,0.1); color: #b45309; }
.tag-short { background: rgba(219,39,119,0.1); color: #be185d; }

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs-nav {
  display: flex;
  gap: 4px;
  padding: 8px 0;
  margin-bottom: 20px;
  border-bottom: 2px solid var(--border);
}
.tab-btn {
  padding: 10px 20px;
  border: none;
  background: transparent;
  color: var(--text-dim);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  transition: all 0.2s;
}
.tab-btn:hover { color: var(--text); }
.tab-btn.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
  font-weight: 600;
}
.tab-panel { display: none; }
.tab-panel.active { display: block; }

/* ‚îÄ‚îÄ OPERATIONS ‚îÄ‚îÄ */
.ops-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
.ops-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.ops-card-title {
  font-weight: 600;
  font-size: 0.85rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 12px;
}
.ops-big { font-size: 2rem; font-weight: 700; font-family: 'Sora', sans-serif; }
.ops-label { font-size: 0.8rem; color: var(--text-dim); margin-top: 4px; }
.pipeline-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
}
.pipeline-item:last-child { border-bottom: none; }
.status-badge {
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
}
.status-identified { background: #f3f4f6; color: #6b7280; }
.status-contacted { background: rgba(37,99,235,0.1); color: #1d4ed8; }
.status-negotiating { background: rgba(217,119,6,0.1); color: #b45309; }
.status-confirmed { background: rgba(22,163,74,0.1); color: #15803d; }
.status-rejected { background: rgba(220,38,38,0.1); color: #b91c1c; }
.upcoming-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
}
.upcoming-item:last-child { border-bottom: none; }
.upcoming-date {
  font-size: 0.75rem;
  color: var(--text-dim);
  min-width: 60px;
}
.upcoming-type {
  padding: 2px 8px;
  border-radius: 8px;
  font-size: 0.7rem;
  font-weight: 600;
}

@media (max-width: 640px) {
  .ops-grid { grid-template-columns: 1fr; }
  .tabs-nav { overflow-x: auto; flex-wrap: nowrap; }
  .tab-btn { white-space: nowrap; padding: 8px 14px; font-size: 0.85rem; }
}

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.footer {
  text-align: center;
  padding: 24px;
  color: var(--text-dim);
  font-size: 0.75rem;
  border-top: 1px solid var(--border);
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 640px) {
  .grid-4 { grid-template-columns: repeat(2, 1fr); }
  .grid-2, .grid-3 { grid-template-columns: 1fr; }
  .kpi-value { font-size: 1.2rem; }
  .container { padding: 16px 12px; }
}
</style>
</head>
<body>

<div class="hero">
  <div class="hero-title">LA SAGA VUELVE</div>
  <div class="hero-sub">Dashboard de Campa√±a ¬∑ Actualizado 19/02/2026 23:48</div>
  <button class="refresh-btn" onclick="triggerRefresh()" id="refresh-btn" title="Actualizar datos">üîÑ Actualizar Datos</button>
</div>

<div class="container">

<!-- ‚ïê‚ïê‚ïê TABS NAV ‚ïê‚ïê‚ïê -->
<div class="tabs-nav">
  <button class="tab-btn active" onclick="switchTab('overview')">üìä Overview</button>
  <button class="tab-btn" onclick="switchTab('platforms')">üì± Plataformas</button>
  <button class="tab-btn" onclick="switchTab('operations')">‚öôÔ∏è Operaciones</button>
</div>

<!-- ‚ïê‚ïê‚ïê TAB: OVERVIEW ‚ïê‚ïê‚ïê -->
<div class="tab-panel active" id="tab-overview">

<div id="kpi-hero"></div>
<div class="grid grid-3" id="overview-kpis"></div>

<!-- Operations Summary Cards -->
<div class="ops-grid" style="margin-top: 20px;">
  <div class="ops-card">
    <div class="ops-card-title">üí¨ Comunidad</div>
    <div id="ops-community-summary"></div>
  </div>
  <div class="ops-card">
    <div class="ops-card-title">üì∞ Prensa</div>
    <div id="ops-press-summary"></div>
  </div>
  <div class="ops-card">
    <div class="ops-card-title">üé§ Booking</div>
    <div id="ops-booking-summary"></div>
  </div>
</div>

<!-- Upcoming Content -->
<div class="section" style="margin-top: 8px;">
  <div class="section-header">
    <div class="section-icon" style="background: rgba(217,119,6,0.12);">üìÖ</div>
    <div class="section-title">Pr√≥ximas Publicaciones</div>
  </div>
  <div class="card">
    <div id="upcoming-content"><span style="color: var(--text-dim); font-size: 0.85rem;">Cargando desde agenda-17A.md...</span></div>
  </div>
</div>

</div><!-- tab-overview -->

<!-- ‚ïê‚ïê‚ïê TAB: PLATFORMS ‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-platforms">

<!-- ‚ïê‚ïê‚ïê INSTAGRAM ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon ig">üì∑</div>
    <div class="section-title">Instagram</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">M√©tricas del Per√≠odo</div>
      <div id="ig-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n de Followers</div>
      <div class="chart-wrap"><canvas id="ig-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê YOUTUBE ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon yt">‚ñ∂Ô∏è</div>
    <div class="section-title">YouTube</div>
  </div>
  <div id="yt-alerts"></div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">M√©tricas del Per√≠odo</div>
      <div id="yt-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Views Diarias (30d)</div>
      <div class="chart-wrap"><canvas id="yt-chart"></canvas></div>
    </div>
  </div>
  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <div class="card-title">Top Videos</div>
      <div id="yt-top-videos"></div>
    </div>
    <div class="card">
      <div class="card-title">Fuentes de Tr√°fico (30d)</div>
      <div class="chart-wrap" style="height:220px"><canvas id="yt-traffic-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SPOTIFY ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon sp">üéµ</div>
    <div class="section-title">Spotify</div>
  </div>
  <div id="sp-alerts"></div>
  <div class="grid grid-3">
    <div class="card">
      <div class="card-title">M√©tricas Actuales</div>
      <div id="sp-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Top Tracks</div>
      <div id="sp-tracks"></div>
    </div>
    <div class="card">
      <div class="card-title">Audiencia por Pa√≠s</div>
      <div id="sp-locations"></div>
    </div>
  </div>
  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <div class="card-title">Demographics</div>
      <div class="chart-wrap" style="height:220px"><canvas id="sp-demo-chart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n Listeners</div>
      <div class="chart-wrap"><canvas id="sp-trend-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê X / TWITTER ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon x">ùïè</div>
    <div class="section-title">X / Twitter</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">M√©tricas de Cuenta</div>
      <div id="x-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n Followers</div>
      <div class="chart-wrap"><canvas id="x-chart"></canvas></div>
    </div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Top Posts</div>
      <div id="x-posts"></div>
    </div>
    <div class="card">
      <div class="card-title">Engagement por Post</div>
      <div class="chart-wrap"><canvas id="x-eng-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TIKTOK ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon tk">‚ô™</div>
    <div class="section-title">TikTok</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">M√©tricas de Cuenta</div>
      <div id="tk-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n Followers</div>
      <div class="chart-wrap"><canvas id="tk-chart"></canvas></div>
    </div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Top Videos</div>
      <div id="tk-posts"></div>
    </div>
    <div class="card">
      <div class="card-title">Views por Video</div>
      <div class="chart-wrap"><canvas id="tk-views-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê EMAIL ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon em">üìß</div>
    <div class="section-title">Email Marketing</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Estado de la Lista</div>
      <div id="em-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n de Suscriptores</div>
      <div class="chart-wrap"><canvas id="em-chart"></canvas></div>
    </div>
  </div>
</div>

</div><!-- tab-platforms -->

<!-- ‚ïê‚ïê‚ïê TAB: OPERATIONS ‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="tab-operations">

<!-- Community Detail -->
<div class="section">
  <div class="section-header">
    <div class="section-icon" style="background: rgba(37,99,235,0.1);">üí¨</div>
    <div class="section-title">Comunidad</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Respuestas por Plataforma</div>
      <div id="community-detail"></div>
    </div>
    <div class="card">
      <div class="card-title">Tendencia de Respuesta</div>
      <div class="chart-wrap"><canvas id="community-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- Press Detail -->
<div class="section">
  <div class="section-header">
    <div class="section-icon" style="background: rgba(147,51,234,0.1);">üì∞</div>
    <div class="section-title">Prensa</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Pipeline de Prensa</div>
      <div id="press-detail"></div>
    </div>
    <div class="card">
      <div class="card-title">Actividad Reciente</div>
      <div id="press-activity"></div>
    </div>
  </div>
</div>

<!-- Booking Detail -->
<div class="section">
  <div class="section-header">
    <div class="section-icon" style="background: rgba(22,163,74,0.1);">üé§</div>
    <div class="section-title">Booking</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Pipeline de Shows</div>
      <div id="booking-pipeline"></div>
    </div>
    <div class="card">
      <div class="card-title">Estado del Pipeline</div>
      <div class="chart-wrap"><canvas id="booking-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- Community Log -->
<div class="section">
  <div class="section-header">
    <div class="section-icon" style="background: rgba(37,99,235,0.1);">üó®Ô∏è</div>
    <div class="section-title">√öltimas Interacciones</div>
  </div>
  <div class="card">
    <div id="community-log"></div>
  </div>
</div>

<!-- Suggestions -->
<div class="section">
  <div class="section-header">
    <div class="section-icon" style="background: rgba(217,119,6,0.12);">üí°</div>
    <div class="section-title">Sugerencias</div>
  </div>
  <div class="card">
    <div id="suggestions"></div>
  </div>
</div>

</div><!-- tab-operations -->

</div><!-- container -->

<div class="footer">
  La Saga Vuelve ¬∑ Dashboard generado autom√°ticamente ¬∑ 19/02/2026 23:48
</div>

<script>
const DATA = {"generated_at": "2026-02-19T23:48:59.009138", "days_to_show": 56, "period_days": 7, "instagram": {"last_date": "2026-02-20", "followers": 3576, "reach": 1628, "accounts_engaged": 164, "period_posts": 3, "period_reach": 7054, "period_engagement": 830, "top_post": {"date": "2026-02-17", "type": "reel", "caption": "\"Algunas canciones se hacen y despu√©s se buscan toda la vida\" \n\nEl primer show e", "reach": 3402}, "trend": [{"date": "2026-02-18", "followers": 3566, "reach": 3319}, {"date": "2026-02-19", "followers": 3576, "reach": 0}, {"date": "2026-02-20", "followers": 3576, "reach": 1628}], "post_types": [{"type": "reel", "posts": 3, "avg_reach": 2351.0, "avg_engagement": 277.0}]}, "email": {"last_date": "2026-02-20", "total_subs": 1635, "period_gained": 0, "period_lost": 6, "campaigns": [{"name": "Bienvenida a la lista", "sent": 503, "open_pct": 62.8, "click_pct": 22.3, "sent_at": "2026-02-13T12:21:59+00:00"}], "last_campaign": {"name": "Bienvenida a la lista", "sent": 503, "open_pct": 62.8, "click_pct": 22.3, "sent_at": "2026-02-13T12:21:59+00:00"}, "avg_open_pct": 62.8, "avg_click_pct": 22.3, "total_campaigns": 1, "trend": [{"date": "2026-02-18", "subs": 1635}, {"date": "2026-02-20", "subs": 1635}]}, "youtube": {"last_date": "2026-02-18", "subscribers": 3720, "total_views": 1543200, "videos_count": 38, "period_views": 1900, "period_likes": 37, "period_shares": 19, "period_watch_min": 3848.0, "period_subs_net": 9, "unreplied_comments": 100, "top_traffic_source": "PLAYLIST", "top_traffic_views": 5544, "traffic_sources": [{"source": "PLAYLIST", "views": 5544}, {"source": "YT_SEARCH", "views": 1868}, {"source": "SUBSCRIBER", "views": 1604}, {"source": "RELATED_VIDEO", "views": 734}, {"source": "SHORTS", "views": 594}, {"source": "NO_LINK_OTHER", "views": 425}, {"source": "YT_OTHER_PAGE", "views": 364}, {"source": "EXT_URL", "views": 339}, {"source": "YT_CHANNEL", "views": 261}, {"source": "NOTIFICATION", "views": 56}, {"source": "SHORTS_CONTENT_LINKS", "views": 4}, {"source": "END_SCREEN", "views": 3}], "top_videos": [{"title": "LA SAGA -  \"Color\" - (Video Oficial)", "views": 498560, "likes": 2221, "type": "Video"}, {"title": "LA SAGA - ONCE", "views": 465209, "likes": 2320, "type": "Video"}, {"title": "\"Errante\" (La Saga - \"INTIMO\")", "views": 161405, "likes": 696, "type": "Video"}, {"title": "La Saga - Yo te quiero (Video Oficial)", "views": 115952, "likes": 689, "type": "Video"}, {"title": "La Saga - Vos  (video oficial)", "views": 106267, "likes": 866, "type": "Video"}], "trend": [{"date": "2026-01-21", "views": 180, "likes": 4, "net_subs": 1}, {"date": "2026-01-22", "views": 196, "likes": 1, "net_subs": 3}, {"date": "2026-01-23", "views": 205, "likes": 1, "net_subs": 0}, {"date": "2026-01-24", "views": 210, "likes": 1, "net_subs": 0}, {"date": "2026-01-25", "views": 144, "likes": 2, "net_subs": 0}, {"date": "2026-01-26", "views": 145, "likes": -1, "net_subs": 0}, {"date": "2026-01-27", "views": 178, "likes": 6, "net_subs": 1}, {"date": "2026-01-28", "views": 209, "likes": 1, "net_subs": 0}, {"date": "2026-01-29", "views": 218, "likes": 3, "net_subs": 0}, {"date": "2026-01-30", "views": 275, "likes": -1, "net_subs": 0}, {"date": "2026-01-31", "views": 232, "likes": 0, "net_subs": 0}, {"date": "2026-02-01", "views": 129, "likes": 0, "net_subs": 0}, {"date": "2026-02-02", "views": 201, "likes": 2, "net_subs": 0}, {"date": "2026-02-03", "views": 177, "likes": -1, "net_subs": -1}, {"date": "2026-02-04", "views": 267, "likes": 4, "net_subs": 1}, {"date": "2026-02-05", "views": 285, "likes": 0, "net_subs": 0}, {"date": "2026-02-06", "views": 186, "likes": 1, "net_subs": 0}, {"date": "2026-02-07", "views": 190, "likes": 0, "net_subs": 2}, {"date": "2026-02-08", "views": 119, "likes": 1, "net_subs": 1}, {"date": "2026-02-09", "views": 149, "likes": 1, "net_subs": -1}, {"date": "2026-02-10", "views": 178, "likes": 0, "net_subs": 0}, {"date": "2026-02-11", "views": 208, "likes": 1, "net_subs": 0}, {"date": "2026-02-12", "views": 221, "likes": 1, "net_subs": 0}, {"date": "2026-02-13", "views": 308, "likes": 2, "net_subs": 2}, {"date": "2026-02-14", "views": 213, "likes": 1, "net_subs": 1}, {"date": "2026-02-15", "views": 320, "likes": 14, "net_subs": 2}, {"date": "2026-02-16", "views": 308, "likes": 5, "net_subs": 3}, {"date": "2026-02-17", "views": 530, "likes": 14, "net_subs": 1}]}, "spotify": {"last_date": "2026-02-20", "monthly_listeners": 22095, "streams_28d": 100383, "followers": 11267, "super_listeners": 422, "saves": 936, "playlist_adds": 938, "top_tracks": [{"name": "Color", "streams": 0, "listeners": 0, "saves": 0}, {"name": "Ir", "streams": 0, "listeners": 0, "saves": 0}, {"name": "Once", "streams": 0, "listeners": 0, "saves": 0}], "demographics": [{"dim": "age", "value": "35-44", "pct": 37.0}, {"dim": "age", "value": "25-34", "pct": 32.0}, {"dim": "age", "value": "45-54", "pct": 18.0}, {"dim": "age", "value": "18-24", "pct": 6.0}, {"dim": "age", "value": "<18", "pct": 0.0}, {"dim": "gender", "value": "male", "pct": 63.0}, {"dim": "gender", "value": "female", "pct": 33.0}, {"dim": "gender", "value": "not_specified", "pct": 3.0}, {"dim": "gender", "value": "non-binary", "pct": 1.0}], "locations": [{"name": "Uruguay", "listeners": 15219}, {"name": "Argentina", "listeners": 4301}, {"name": "Spain", "listeners": 629}, {"name": "Mexico", "listeners": 421}, {"name": "Brazil", "listeners": 271}], "days_since_collection": -1, "trend": [{"date": "2026-02-18", "listeners": 21909, "streams": 100745, "followers": 11261}, {"date": "2026-02-20", "listeners": 22095, "streams": 100383, "followers": 11267}]}, "x": {"last_date": "2026-02-20", "followers": 1365, "following": 469, "top_posts": [{"post_id": "2024191756430884898", "date": "2026-02-18", "text": "#lasagavuelve [Imagen LA SAGA VUELVE]", "impressions": 73, "likes": 12, "retweets": 1, "bookmarks": 0, "replies": 1}, {"post_id": "1067231560431210496", "date": "2018-11-26", "text": "¬øQuien tiene ganas de despedida?", "impressions": 0, "likes": 8, "retweets": 2, "bookmarks": 0, "replies": 0}, {"post_id": "1077578455066333185", "date": "2018-12-25", "text": "Esta navidad es una navidad diferente para nosotros. Luego de agradecer la salud", "impressions": 0, "likes": 5, "retweets": 0, "bookmarks": 0, "replies": 0}, {"post_id": "1068257944830124033", "date": "2018-11-29", "text": "Te invitamos a despedir el a√±o con nosotros el viernes 14 de diciembre, 21 hs. L", "impressions": 0, "likes": 3, "retweets": 0, "bookmarks": 0, "replies": 1}, {"post_id": "1073272298747113473", "date": "2018-12-13", "text": "Nos vemos ma√±ana?", "impressions": 0, "likes": 1, "retweets": 0, "bookmarks": 0, "replies": 0}], "trend": [{"date": "2026-02-19", "followers": 1364}, {"date": "2026-02-20", "followers": 1365}]}, "tiktok": {"last_date": "2026-02-20", "followers": 2, "likes_total": 1, "top_posts": [{"post_id": "7577916687123631416", "date": "2025-11-28", "description": "COMUNICADO URGENTE - De d√≥nde quer√©s venir ma√±ana", "views": 105, "likes": 0, "shares": 0, "comments": 0, "saves": 0}, {"post_id": "7580842031635778872", "date": "2025-12-06", "description": "COMUNICADO DE LA GERENCIA: EL HORIZONTE OTRA VEZ - Quiero", "views": 89, "likes": 1, "shares": 0, "comments": 0, "saves": 0}], "trend": [{"date": "2026-02-19", "followers": 2}, {"date": "2026-02-20", "followers": 2}]}, "community": {"platforms": {"instagram": {"comments_received": 24, "comments_replied": 11, "dms_received": 4, "dms_replied": 2, "mentions_received": 0, "mentions_replied": 0, "likes_given": 12, "response_time_avg_min": 30}, "tiktok": {"comments_received": 0, "comments_replied": 0, "dms_received": 0, "dms_replied": 0, "mentions_received": 0, "mentions_replied": 0, "likes_given": 0, "response_time_avg_min": 0}, "x": {"comments_received": 7, "comments_replied": 6, "dms_received": 0, "dms_replied": 0, "mentions_received": 3, "mentions_replied": 0, "likes_given": 6, "response_time_avg_min": 120}, "youtube": {"comments_received": 0, "comments_replied": 0, "dms_received": 0, "dms_replied": 0, "mentions_received": 0, "mentions_replied": 0, "likes_given": 0, "response_time_avg_min": 0}}, "total_received": 38, "total_replied": 19, "response_rate": 50, "total_likes": 18, "trend": [{"date": "2026-02-20", "received": 38, "replied": 19}]}, "community_log": [{"date": "2026-02-20", "platform": "x", "type": "opportunity", "description": "Canciones pedidas para setlist: Peor es olvidar, Las historias del silencio, Podemos, Somos invisibles, Errante, Buscando Espacio, Suerte"}, {"date": "2026-02-20", "platform": "x", "type": "repost", "description": "Metr√≥nomo (@Metronomo_uy) y 2 m√°s repostearon post #lasagavuelve"}, {"date": "2026-02-20", "platform": "x", "type": "repost", "description": "MadeinUruguay (@araucaria1) reposte√≥ el post del Short S2"}, {"date": "2026-02-20", "platform": "x", "type": "new_follower", "description": "Radio Belcha (@RadioBelcha) nos sigui√≥ - medio de radio"}, {"date": "2026-02-20", "platform": "x", "type": "like", "description": "Likeados 6 comentarios de fans en post de setlist"}, {"date": "2026-02-20", "platform": "x", "type": "reply", "description": "Respond√≠ a @NachoObes - Buen regreso"}, {"date": "2026-02-20", "platform": "x", "type": "reply", "description": "Respond√≠ a @AndresMdf182 pidiendo Suerte para el setlist"}, {"date": "2026-02-20", "platform": "x", "type": "reply", "description": "Respond√≠ a @Nando_008 pidiendo Buscando Espacio - le avis√© que sale domingo en YT"}, {"date": "2026-02-20", "platform": "x", "type": "reply", "description": "Respond√≠ a @LORENARI1976 pidiendo Somos invisibles y Errante"}, {"date": "2026-02-20", "platform": "x", "type": "reply", "description": "Respond√≠ a @TortuBolso pidiendo Podemos para el setlist"}, {"date": "2026-02-20", "platform": "x", "type": "reply", "description": "Respond√≠ a @nicoanormal1 (NIKOVEUY) sobre el regreso"}, {"date": "2026-02-20", "platform": "x", "type": "reply", "description": "Respond√≠ a @vendavalero pidiendo Peor es olvidar y Las historias del silencio para el setlist"}, {"date": "2026-02-20", "platform": "instagram", "type": "opportunity", "description": "Fan pide El perfume de tu cama para setlist - registrar para ensayos"}, {"date": "2026-02-20", "platform": "instagram", "type": "opportunity", "description": "Math93 sugiere programa Suena Bien - sesiones ac√∫sticas. Idea para post-show"}, {"date": "2026-02-20", "platform": "instagram", "type": "like", "description": "Likeados 12 comentarios en reel Buscando Espacio (todos los pendientes)"}], "suggestions": [{"priority": "alta", "area": "Comunidad", "text": "Tasa de respuesta en 50%. Objetivo: >80%. Aumentar rondas de comunidad."}, {"priority": "media", "area": "Prensa", "text": "Sin contactos de prensa registrados. Activar outreach (cron Prensa, martes)."}, {"priority": "alta", "area": "Booking", "text": "Sala del Museo del Carnaval sigue en 'identified'. Contactar esta semana."}], "press": {"total_contacts": 0, "emails_sent": 0, "responses": 0, "coverage": 0, "recent_activity": [], "trend": []}, "booking": {"venues": [{"name": "Wannaclap", "city": "Montevideo", "capacity": 0, "date_target": "17 Abril 2026", "status": "confirmed", "contacted": null, "notes": "Show principal La Saga Vuelve"}, {"name": "Sala del Museo del Carnaval", "city": "Montevideo", "capacity": 0, "date_target": "Agosto/Septiembre 2026", "status": "identified", "contacted": null, "notes": "Show post-17A. Averiguar disponibilidad y condiciones."}], "by_status": {"confirmed": 1, "identified": 1}, "total": 2}, "upcoming": {"items": [{"date": "2026-02-19", "platform": "instagram", "type": "short", "description": "S2 Libro de tablaturas (cross: IG + X + TikTok + YT Shorts)", "status": "planned"}, {"date": "2026-02-21", "platform": "instagram", "type": "carousel", "description": "Carrusel Buscando Espacio (concepto Memoria Imperfecta)", "status": "planned"}, {"date": "2026-02-22", "platform": "youtube", "type": "full_song", "description": "Buscando Espacio - canci√≥n completa (ya subida oculta, pasar a p√∫blico)", "status": "planned"}, {"date": "2026-02-24", "platform": "instagram", "type": "reel", "description": "Estribillo Ya no saben qu√© decir (pedir frase a Nico)", "status": "planned"}, {"date": "2026-02-26", "platform": "instagram", "type": "short", "description": "S4 Pilsen Rock y Vel√≥dromo (cross: IG + X + TikTok + YT Shorts)", "status": "planned"}], "source": "upcoming_content"}, "financials": {"total_expenses": 0, "total_income": 0, "balance": 0}, "show": {"venue": "Wannaclap", "capacity": 0, "tickets_sold": 0, "revenue": 0.0, "status": "confirmed"}, "kpi_history": [{"date": "2026-02-18", "total_followers": 18547, "total_reach": 6508, "total_engagement": 675, "email_list_size": 1635, "tickets_sold_total": 0}, {"date": "2026-02-19", "total_followers": 7296, "total_reach": 5898, "total_engagement": 480, "email_list_size": 1635, "tickets_sold_total": 0}]};

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function fmt(n) {
  if (n == null) return 'N/A';
  if (Math.abs(n) >= 1e6) return (n/1e6).toFixed(1) + 'M';
  if (Math.abs(n) >= 1e3) return (n/1e3).toFixed(1) + 'K';
  return n.toLocaleString('es-UY');
}
function fmtChg(val, pct) {
  if (val == null) return '';
  const sign = val >= 0 ? '+' : '';
  let s = sign + val;
  if (pct != null) s += ' (' + sign + pct + '%)';
  return s;
}
function chgClass(val) {
  if (val == null || val === 0) return 'neutral';
  return val > 0 ? 'pos' : 'neg';
}
function shortDate(d) {
  const parts = d.split('-');
  return parts[2] + '/' + parts[1];
}

// ‚îÄ‚îÄ Chart defaults ‚îÄ‚îÄ
Chart.defaults.color = '#6b7280';
Chart.defaults.borderColor = 'rgba(0,0,0,0.06)';
Chart.defaults.font.family = "'DM Sans', sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.plugins.legend.display = false;

function lineChart(id, labels, datasets, opts) {
  return new Chart(document.getElementById(id), {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { intersect: false, mode: 'index' },
      scales: {
        x: { grid: { display: false }, ticks: { maxTicksLimit: 8 } },
        y: { grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { callback: v => fmt(v) } }
      },
      plugins: {
        tooltip: {
          backgroundColor: '#ffffff',
          borderColor: '#dde0e6',
          borderWidth: 1,
          titleColor: '#1a1d23',
          bodyColor: '#6b7280',
          padding: 10
        }
      },
      ...opts
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ Overview KPIs ‚îÄ‚îÄ
(function() {
  const ig = DATA.instagram, em = DATA.email, yt = DATA.youtube, sp = DATA.spotify, xd = DATA.x, tk = DATA.tiktok;
  const igF = ig.followers||0, ytS = yt.subscribers||0, spF = sp.followers||0, emS = em.total_subs||0, xF = xd.followers||0, tkF = tk.followers||0;
  const totalFollowers = igF + ytS + spF + xF + tkF;
  const totalAudience = totalFollowers + emS;
  const igR = ig.period_reach||0, ytV = yt.period_views||0;
  const totalReach = igR + ytV;
  const igE = ig.period_engagement||0, ytE = (yt.period_likes||0) + (yt.period_shares||0);
  const totalEngagement = igE + ytE;

  const COLORS = {ig:'#C13584', yt:'#CC0000', sp:'#1DB954', em:'#2563eb', x:'#1a1d23', tk:'#00f2ea'};

  function tabs(segments) {
    const active = segments.filter(s => s.val > 0).sort((a,b) => b.val - a.val);
    if (active.length === 0) return '';
    return `<div class="tearoff">${active.map(s =>
      `<div class="tearoff-tab">
        <div class="tearoff-color" style="background:${s.color}"></div>
        <div class="tearoff-val">${fmt(s.val)}</div>
        <div class="tearoff-name">${s.name}</div>
      </div>`
    ).join('')}</div>`;
  }

  const heroKpi = { label: 'Audiencia Total', value: fmt(totalAudience),
    tearoff: tabs([
      {name:'Spotify', val:spF, color:COLORS.sp},
      {name:'YouTube', val:ytS, color:COLORS.yt},
      {name:'IG', val:igF, color:COLORS.ig},
      {name:'Email', val:emS, color:COLORS.em},
      {name:'X', val:xF, color:COLORS.x},
      {name:'TikTok', val:tkF, color:COLORS.tk}
    ]) };

  const kpis = [
    { label: 'Followers', value: fmt(totalFollowers),
      tearoff: tabs([
        {name:'Spotify', val:spF, color:COLORS.sp},
        {name:'YouTube', val:ytS, color:COLORS.yt},
        {name:'IG', val:igF, color:COLORS.ig},
        {name:'X', val:xF, color:COLORS.x},
        {name:'TikTok', val:tkF, color:COLORS.tk}
      ]) },
    { label: 'Reach (' + DATA.period_days + 'd)', value: fmt(totalReach),
      tearoff: tabs([
        {name:'IG', val:igR, color:COLORS.ig},
        {name:'YouTube', val:ytV, color:COLORS.yt}
      ]) },
    { label: 'Engagement (' + DATA.period_days + 'd)', value: fmt(totalEngagement),
      tearoff: tabs([
        {name:'IG', val:igE, color:COLORS.ig},
        {name:'YouTube', val:ytE, color:COLORS.yt}
      ]) }
  ];

  document.getElementById('kpi-hero').innerHTML = `
    <div class="kpi-hero">
      <div class="kpi-label">${heroKpi.label}</div>
      <div class="kpi-value">${heroKpi.value}</div>
      ${heroKpi.tearoff}
    </div>`;

  document.getElementById('overview-kpis').innerHTML = kpis.map(k => `
    <div class="kpi">
      <div class="kpi-label">${k.label}</div>
      <div class="kpi-value">${k.value}</div>
      ${k.tearoff}
    </div>
  `).join('');
})();

// ‚îÄ‚îÄ Instagram ‚îÄ‚îÄ
(function() {
  const ig = DATA.instagram;
  let rows = [
    ['Followers', fmt(ig.followers), fmtChg(ig.followers_change, ig.followers_pct), chgClass(ig.followers_change)],
    ['Posts (per√≠odo)', ig.period_posts || 0, '', ''],
    ['Reach', fmt(ig.period_reach), '', ''],
    ['Engagement', fmt(ig.period_engagement), '', ''],
  ];
  if (ig.top_post) {
    rows.push(['Top Post', `<span class="tag tag-${ig.top_post.type}">${ig.top_post.type}</span> ${fmt(ig.top_post.reach)} reach`, '', '']);
  }
  document.getElementById('ig-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  if (ig.trend && ig.trend.length > 1) {
    lineChart('ig-chart',
      ig.trend.map(t => shortDate(t.date)),
      [{ label: 'Followers', data: ig.trend.map(t => t.followers),
          borderColor: '#E1306C', backgroundColor: 'rgba(225,48,108,0.1)',
          fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }]
    );
  }
})();

// ‚îÄ‚îÄ Email ‚îÄ‚îÄ
(function() {
  const em = DATA.email;
  let rows = [
    ['Suscriptores', fmt(em.total_subs), fmtChg(em.subs_change, em.subs_pct), chgClass(em.subs_change)],
    ['Nuevos (per√≠odo)', '+' + (em.period_gained || 0), '', ''],
    ['Bajas (per√≠odo)', '-' + (em.period_lost || 0), '', em.period_lost > 0 ? 'neg' : ''],
  ];
  if (em.last_campaign) {
    const lc = em.last_campaign;
    rows.push(['√öltima campa√±a', lc.name, '', '']);
    rows.push(['Open Rate', lc.open_pct + '%', '', '']);
    rows.push(['Click Rate', lc.click_pct + '%', '', '']);
  }
  if (em.avg_open_pct != null) {
    rows.push(['Promedio Open Rate', em.avg_open_pct + '%', '', '']);
    rows.push(['Promedio Click Rate', em.avg_click_pct + '%', '', '']);
  }
  document.getElementById('em-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  if (em.trend && em.trend.length > 1) {
    lineChart('em-chart',
      em.trend.map(t => shortDate(t.date)),
      [{ label: 'Suscriptores', data: em.trend.map(t => t.subs),
          borderColor: '#3B82F6', backgroundColor: 'rgba(59,130,246,0.1)',
          fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }]
    );
  }
})();

// ‚îÄ‚îÄ YouTube ‚îÄ‚îÄ
(function() {
  const yt = DATA.youtube;

  // Alerts
  let alerts = '';
  if (yt.unreplied_comments > 0) {
    alerts += `<div class="alert">‚ö†Ô∏è ${yt.unreplied_comments} comentarios sin responder</div>`;
  }
  document.getElementById('yt-alerts').innerHTML = alerts;

  let rows = [
    ['Subscribers', fmt(yt.subscribers), fmtChg(yt.subs_change, yt.subs_pct), chgClass(yt.subs_change)],
    ['Views (per√≠odo)', fmt(yt.period_views), '', ''],
    ['Watch Time', fmt(yt.period_watch_min) + ' min', '', ''],
    ['Subs netos', fmtChg(yt.period_subs_net, null), '', chgClass(yt.period_subs_net)],
    ['Views totales', fmt(yt.total_views), '', ''],
  ];
  if (yt.top_traffic_source) {
    rows.push(['Traffic #1', yt.top_traffic_source, '', '']);
  }
  document.getElementById('yt-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  // Views trend
  if (yt.trend && yt.trend.length > 1) {
    lineChart('yt-chart',
      yt.trend.map(t => shortDate(t.date)),
      [{ label: 'Views', data: yt.trend.map(t => t.views),
          borderColor: '#FF0000', backgroundColor: 'rgba(255,0,0,0.08)',
          fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }]
    );
  }

  // Top videos
  if (yt.top_videos && yt.top_videos.length) {
    document.getElementById('yt-top-videos').innerHTML = `
      <table class="data-table">
        <thead><tr><th>Video</th><th>Views</th><th>Likes</th></tr></thead>
        <tbody>
          ${yt.top_videos.map(v => `
            <tr>
              <td><span class="tag tag-${v.type.toLowerCase()}">${v.type}</span> ${v.title.substring(0, 35)}</td>
              <td>${fmt(v.views)}</td>
              <td>${fmt(v.likes)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }

  // Traffic sources (doughnut)
  if (yt.traffic_sources && yt.traffic_sources.length) {
    const colors = ['#f59e0b','#3b82f6','#22c55e','#a855f7','#ec4899','#ef4444','#06b6d4','#84cc16'];
    new Chart(document.getElementById('yt-traffic-chart'), {
      type: 'doughnut',
      data: {
        labels: yt.traffic_sources.map(s => s.source),
        datasets: [{ data: yt.traffic_sources.map(s => s.views),
          backgroundColor: colors.slice(0, yt.traffic_sources.length),
          borderWidth: 0 }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: {
          legend: { display: true, position: 'right',
            labels: { boxWidth: 10, padding: 8, font: { size: 10 } } }
        }
      }
    });
  }
})();

// ‚îÄ‚îÄ Spotify ‚îÄ‚îÄ
(function() {
  const sp = DATA.spotify;

  // Alerts
  let alerts = '';
  if ((sp.days_since_collection || 0) > 8) {
    alerts += `<div class="alert">‚ö†Ô∏è √öltima recolecci√≥n hace ${sp.days_since_collection} d√≠as ‚Äî login requerido</div>`;
  }
  document.getElementById('sp-alerts').innerHTML = alerts;

  // Metrics
  let rows = [
    ['Monthly Listeners', fmt(sp.monthly_listeners), fmtChg(sp.listeners_change, sp.listeners_pct), chgClass(sp.listeners_change)],
    ['Streams (28d)', fmt(sp.streams_28d), fmtChg(sp.streams_change, null), chgClass(sp.streams_change)],
    ['Followers', fmt(sp.followers), '', ''],
    ['Super Listeners', sp.super_listeners || 'N/A', '', ''],
    ['Saves', fmt(sp.saves), '', ''],
    ['Playlist Adds', fmt(sp.playlist_adds), '', ''],
  ];
  document.getElementById('sp-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  // Top tracks
  if (sp.top_tracks && sp.top_tracks.length) {
    document.getElementById('sp-tracks').innerHTML = `
      <table class="data-table">
        <thead><tr><th>Track</th><th>Streams</th><th>Saves</th></tr></thead>
        <tbody>
          ${sp.top_tracks.slice(0, 8).map(t => `
            <tr>
              <td>${t.name.substring(0, 30)}</td>
              <td>${fmt(t.streams)}</td>
              <td>${fmt(t.saves)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }

  // Locations
  if (sp.locations && sp.locations.length) {
    document.getElementById('sp-locations').innerHTML = sp.locations.map((l, i) => `
      <div class="metric-row">
        <span class="metric-name">${l.name}</span>
        <span class="metric-val">${fmt(l.listeners)}</span>
      </div>
    `).join('');
  }

  // Demographics (bar chart)
  if (sp.demographics && sp.demographics.length) {
    const ageData = sp.demographics.filter(d => d.dim === 'age');
    if (ageData.length) {
      new Chart(document.getElementById('sp-demo-chart'), {
        type: 'bar',
        data: {
          labels: ageData.map(d => d.value),
          datasets: [{ label: '%', data: ageData.map(d => d.pct),
            backgroundColor: 'rgba(29,185,84,0.6)', borderRadius: 4, barPercentage: 0.7 }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: {
            x: { grid: { display: false } },
            y: { grid: { color: 'rgba(0,0,0,0.05)' },
              ticks: { callback: v => v + '%' } }
          }
        }
      });
    }
  }

  // Listeners trend
  if (sp.trend && sp.trend.length > 1) {
    lineChart('sp-trend-chart',
      sp.trend.map(t => shortDate(t.date)),
      [{ label: 'Monthly Listeners', data: sp.trend.map(t => t.listeners),
          borderColor: '#1DB954', backgroundColor: 'rgba(29,185,84,0.1)',
          fill: true, tension: 0.3, pointRadius: 2, borderWidth: 2 }]
    );
  }
})();

// ‚îÄ‚îÄ X / Twitter ‚îÄ‚îÄ
(function() {
  const xd = DATA.x;
  if (!xd || (!xd.followers && !xd.top_posts)) return;

  // Account metrics
  const rows = [];
  rows.push(['Followers', fmt(xd.followers || 0)]);
  if (xd.followers_prev != null) {
    const diff = (xd.followers||0) - xd.followers_prev;
    rows.push(['Cambio (per√≠odo)', `<span class="kpi-change ${chgClass(diff)}">${diff >= 0 ? '+' : ''}${diff}</span>`]);
  }
  rows.push(['Following', fmt(xd.following || 0)]);
  if (xd.last_date) rows.push(['√öltima actualizaci√≥n', xd.last_date]);

  const el = document.getElementById('x-metrics');
  if (el) {
    el.innerHTML = rows.map(r => `<div class="metric-row"><span>${r[0]}</span><strong>${r[1]}</strong></div>`).join('');
  }

  // Top posts table
  if (xd.top_posts && xd.top_posts.length > 0) {
    const postsEl = document.getElementById('x-posts');
    if (postsEl) {
      let html = '<table class="data-table"><tr><th>Post</th><th>‚ù§Ô∏è</th><th>üîÅ</th><th>üí¨</th></tr>';
      xd.top_posts.forEach(p => {
        html += `<tr><td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.text}</td><td>${fmt(p.likes)}</td><td>${fmt(p.retweets)}</td><td>${fmt(p.replies)}</td></tr>`;
      });
      html += '</table>';
      postsEl.innerHTML = html;
    }
  }

  // Followers trend
  if (xd.trend && xd.trend.length > 1) {
    lineChart('x-chart',
      xd.trend.map(t => shortDate(t.date)),
      [{ label: 'Followers', data: xd.trend.map(t => t.followers),
          borderColor: '#1a1d23', backgroundColor: 'rgba(26,29,35,0.08)',
          fill: true, tension: 0.3, pointRadius: 2, borderWidth: 2 }]
    );
  }

  // Engagement chart (likes + retweets + replies per post)
  if (xd.top_posts && xd.top_posts.length > 0) {
    new Chart(document.getElementById('x-eng-chart'), {
      type: 'bar',
      data: {
        labels: xd.top_posts.map(p => p.text.substring(0, 20) + '...'),
        datasets: [
          { label: 'Likes', data: xd.top_posts.map(p => p.likes), backgroundColor: '#ef4444' },
          { label: 'Retweets', data: xd.top_posts.map(p => p.retweets), backgroundColor: '#3b82f6' },
          { label: 'Replies', data: xd.top_posts.map(p => p.replies), backgroundColor: '#22c55e' }
        ]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: true, position: 'bottom' } },
        scales: {
          x: { stacked: true, grid: { display: false }, ticks: { display: false } },
          y: { stacked: true, grid: { color: 'rgba(0,0,0,0.05)' } }
        }
      }
    });
  }
})();

// ‚îÄ‚îÄ TikTok ‚îÄ‚îÄ
(function() {
  const tk = DATA.tiktok;
  if (!tk || (!tk.followers && !tk.top_posts)) return;

  // Account metrics
  const rows = [];
  rows.push(['Followers', fmt(tk.followers || 0)]);
  if (tk.followers_prev != null) {
    const diff = (tk.followers||0) - tk.followers_prev;
    rows.push(['Cambio (per√≠odo)', `<span class="kpi-change ${chgClass(diff)}">${diff >= 0 ? '+' : ''}${diff}</span>`]);
  }
  rows.push(['Likes Totales', fmt(tk.likes_total || 0)]);
  if (tk.last_date) rows.push(['√öltima actualizaci√≥n', tk.last_date]);

  const el = document.getElementById('tk-metrics');
  if (el) {
    el.innerHTML = rows.map(r => `<div class="metric-row"><span>${r[0]}</span><strong>${r[1]}</strong></div>`).join('');
  }

  // Top posts table
  if (tk.top_posts && tk.top_posts.length > 0) {
    const postsEl = document.getElementById('tk-posts');
    if (postsEl) {
      let html = '<table class="data-table"><tr><th>Video</th><th>üëÅ</th><th>‚ù§Ô∏è</th><th>üí¨</th></tr>';
      tk.top_posts.forEach(p => {
        html += `<tr><td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.description}</td><td>${fmt(p.views)}</td><td>${fmt(p.likes)}</td><td>${fmt(p.comments)}</td></tr>`;
      });
      html += '</table>';
      postsEl.innerHTML = html;
    }
  }

  // Followers trend
  if (tk.trend && tk.trend.length > 1) {
    lineChart('tk-chart',
      tk.trend.map(t => shortDate(t.date)),
      [{ label: 'Followers', data: tk.trend.map(t => t.followers),
          borderColor: '#00f2ea', backgroundColor: 'rgba(0,242,234,0.08)',
          fill: true, tension: 0.3, pointRadius: 2, borderWidth: 2 }]
    );
  }

  // Views chart
  if (tk.top_posts && tk.top_posts.length > 0) {
    new Chart(document.getElementById('tk-views-chart'), {
      type: 'bar',
      data: {
        labels: tk.top_posts.map(p => (p.description || '').substring(0, 20) + '...'),
        datasets: [{ label: 'Views', data: tk.top_posts.map(p => p.views),
          backgroundColor: '#00f2ea', borderRadius: 4 }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        scales: {
          x: { grid: { display: false }, ticks: { display: false } },
          y: { grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { callback: v => fmt(v) } }
        }
      }
    });
  }
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEBHOOK CONFIG ‚Äî Edit this URL after setting up cloudflare tunnel
const WEBHOOK_URL = localStorage.getItem('saga_webhook_url') || '';

async function triggerRefresh() {
  const btn = document.getElementById('refresh-btn');
  if (!WEBHOOK_URL) {
    const url = prompt('Peg√° la URL del webhook (se guarda para la pr√≥xima):', '');
    if (url) {
      localStorage.setItem('saga_webhook_url', url);
      location.reload();
    }
    return;
  }
  btn.classList.add('loading');
  btn.textContent = '‚è≥ Actualizando...';
  try {
    const res = await fetch(WEBHOOK_URL + '/trigger', { method: 'POST', mode: 'cors' });
    const data = await res.json();
    if (data.ok) {
      btn.classList.remove('loading');
      btn.classList.add('success');
      btn.textContent = '‚úÖ Listo ‚Äî Recargando...';
      setTimeout(() => location.reload(), 5000);
    } else {
      throw new Error(data.error || 'Error');
    }
  } catch(e) {
    btn.classList.remove('loading');
    btn.classList.add('error');
    btn.textContent = '‚ùå Error ‚Äî Click para reintentar';
    setTimeout(() => {
      btn.classList.remove('error');
      btn.textContent = 'üîÑ Actualizar Datos';
    }, 3000);
  }
}

// TAB SWITCHING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(name) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  event.target.classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OPERATIONS ‚Äî Overview Summary Cards
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function() {
  // Community summary
  const comm = DATA.community;
  const commEl = document.getElementById('ops-community-summary');
  if (commEl) {
    const rate = comm.response_rate || 0;
    const rateColor = rate >= 80 ? 'var(--green)' : rate >= 50 ? 'var(--accent)' : 'var(--red)';
    commEl.innerHTML = `
      <div class="ops-big" style="color: ${rateColor}">${rate}%</div>
      <div class="ops-label">Tasa de respuesta</div>
      <div style="margin-top:8px;font-size:0.8rem;color:var(--text-dim)">
        ${fmt(comm.total_replied||0)} / ${fmt(comm.total_received||0)} interacciones
      </div>`;
  }

  // Press summary
  const press = DATA.press;
  const pressEl = document.getElementById('ops-press-summary');
  if (pressEl) {
    const convRate = press.emails_sent > 0 ? Math.round(press.responses / press.emails_sent * 100) : 0;
    pressEl.innerHTML = `
      <div class="ops-big">${press.total_contacts||0}</div>
      <div class="ops-label">Contactos en base</div>
      <div style="margin-top:8px;font-size:0.8rem;color:var(--text-dim)">
        ${press.emails_sent||0} enviados ¬∑ ${press.responses||0} respuestas (${convRate}%)
        <br>${press.coverage||0} coberturas
      </div>`;
  }

  // Booking summary
  const book = DATA.booking;
  const bookEl = document.getElementById('ops-booking-summary');
  if (bookEl) {
    const confirmed = book.by_status?.confirmed || 0;
    const contacted = book.by_status?.contacted || 0;
    const identified = book.by_status?.identified || 0;
    bookEl.innerHTML = `
      <div class="ops-big" style="color: ${confirmed > 0 ? 'var(--green)' : 'var(--text)'}">${book.total||0}</div>
      <div class="ops-label">Venues en pipeline</div>
      <div style="margin-top:8px;font-size:0.8rem;color:var(--text-dim)">
        ${confirmed} confirmados ¬∑ ${contacted} contactados ¬∑ ${identified} identificados
      </div>`;
  }
})();

// ‚îÄ‚îÄ Upcoming Content ‚îÄ‚îÄ
(function() {
  const el = document.getElementById('upcoming-content');
  if (!el) return;

  const upcoming = DATA.upcoming || {};
  const items = upcoming.items || [];

  if (items.length > 0) {
    const platformIcons = {'instagram':'üì∑','youtube':'‚ñ∂Ô∏è','x':'ùïè','tiktok':'‚ô™','email':'üìß','':'üìå'};
    const statusStyles = {
      'published': {bg:'#16a34a22',color:'#15803d',label:'‚úÖ hecho'},
      'planned':   {bg:'#3b82f622',color:'#1d4ed8',label:'üìã plan'},
      'ready':     {bg:'#16a34a22',color:'#15803d',label:'üü¢ listo'},
      'pending':   {bg:'#d9770622',color:'#b45309',label:'‚è≥ pendiente'}
    };
    let html = '<div style="font-size:0.85rem;">';
    items.forEach(item => {
      const icon = platformIcons[item.platform] || 'üìå';
      const st = statusStyles[item.status] || statusStyles['planned'];
      const done = item.status === 'published';
      const textStyle = done ? 'text-decoration:line-through;opacity:0.6' : '';
      html += `<div class="upcoming-item" style="${done ? 'opacity:0.7' : ''}">
        <span class="upcoming-date">${item.date || ''}</span>
        <span style="${textStyle};flex:1">${icon} ${item.description}</span>
        <span style="background:${st.bg};color:${st.color};padding:2px 8px;border-radius:8px;font-size:0.7rem;font-weight:600;white-space:nowrap">${st.label}</span>
      </div>`;
    });
    html += `<div style="margin-top:8px;font-size:0.7rem;color:var(--text-dim)">Fuente: ${upcoming.source}</div>`;
    html += '</div>';
    el.innerHTML = html;
  } else {
    el.innerHTML = `<div style="color:var(--text-dim);font-size:0.85rem;padding:8px 4px">
      üìã Dylan carga el plan los lunes y jueves desde agenda-17A.md.
    </div>`;
  }
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OPERATIONS ‚Äî Detail Panels
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ Community Detail ‚îÄ‚îÄ
(function() {
  const comm = DATA.community;
  const el = document.getElementById('community-detail');
  if (!el) return;

  const platforms = comm.platforms || {};
  const names = {'instagram': 'üì∑ Instagram', 'x': 'ùïè X', 'youtube': '‚ñ∂Ô∏è YouTube', 'tiktok': '‚ô™ TikTok'};
  let html = '<table class="data-table"><tr><th>Plataforma</th><th>Recibidos</th><th>Respondidos</th><th>Tasa</th></tr>';
  for (const [p, d] of Object.entries(platforms)) {
    const total = (d.comments_received||0) + (d.dms_received||0) + (d.mentions_received||0);
    const replied = (d.comments_replied||0) + (d.dms_replied||0) + (d.mentions_replied||0);
    const rate = total > 0 ? Math.round(replied/total*100) : 0;
    const color = rate >= 80 ? 'var(--green)' : rate >= 50 ? 'var(--accent)' : 'var(--red)';
    html += `<tr><td>${names[p]||p}</td><td>${total}</td><td>${replied}</td><td style="color:${color};font-weight:600">${rate}%</td></tr>`;
  }
  html += '</table>';
  if (Object.keys(platforms).length === 0) {
    html = '<div style="color:var(--text-dim);font-size:0.85rem;padding:12px">Sin datos de comunidad a√∫n. Dylan reportar√° despu√©s de las rondas AM/PM.</div>';
  }
  el.innerHTML = html;

  // Community trend chart
  if (comm.trend && comm.trend.length > 1) {
    lineChart('community-chart',
      comm.trend.map(t => shortDate(t.date)),
      [
        { label: 'Recibidos', data: comm.trend.map(t => t.received),
           borderColor: '#6b7280', backgroundColor: 'rgba(107,114,128,0.05)',
           fill: false, tension: 0.3, pointRadius: 2, borderWidth: 2 },
        { label: 'Respondidos', data: comm.trend.map(t => t.replied),
           borderColor: '#16a34a', backgroundColor: 'rgba(22,163,74,0.08)',
           fill: true, tension: 0.3, pointRadius: 2, borderWidth: 2 }
      ],
      { plugins: { legend: { display: true, position: 'bottom' } } }
    );
  }
})();

// ‚îÄ‚îÄ Press Detail ‚îÄ‚îÄ
(function() {
  const press = DATA.press;
  const el = document.getElementById('press-detail');
  if (!el) return;

  let html = `
    <div class="metric-row"><span>Contactos en base</span><strong>${press.total_contacts||0}</strong></div>
    <div class="metric-row"><span>Emails enviados</span><strong>${press.emails_sent||0}</strong></div>
    <div class="metric-row"><span>Respuestas</span><strong>${press.responses||0}</strong></div>
    <div class="metric-row"><span>Coberturas publicadas</span><strong>${press.coverage||0}</strong></div>`;
  el.innerHTML = html;

  // Recent activity
  const actEl = document.getElementById('press-activity');
  if (actEl) {
    const items = press.recent_activity || [];
    if (items.length > 0) {
      let ahtml = '<table class="data-table"><tr><th>Fecha</th><th>Contacto</th><th>Medio</th><th>Estado</th></tr>';
      items.forEach(a => {
        let status = 'üìù Registrado';
        if (a.published) status = '‚úÖ Publicado';
        else if (a.response) status = 'üí¨ Respondi√≥';
        else if (a.sent) status = 'üìß Enviado';
        ahtml += `<tr><td>${a.date}</td><td>${a.contact}</td><td>${a.outlet}</td><td>${status}</td></tr>`;
      });
      ahtml += '</table>';
      actEl.innerHTML = ahtml;
    } else {
      actEl.innerHTML = '<div style="color:var(--text-dim);font-size:0.85rem;padding:12px">Sin actividad de prensa registrada a√∫n.</div>';
    }
  }
})();

// ‚îÄ‚îÄ Booking Detail ‚îÄ‚îÄ
(function() {
  const book = DATA.booking;
  const el = document.getElementById('booking-pipeline');
  if (!el) return;

  const venues = book.venues || [];
  if (venues.length > 0) {
    let html = '';
    venues.forEach(v => {
      html += `<div class="pipeline-item">
        <div>
          <strong>${v.name}</strong><br>
          <span style="font-size:0.8rem;color:var(--text-dim)">${v.city} ${v.capacity ? '¬∑ ' + v.capacity + ' cap.' : ''} ${v.date_target ? '¬∑ ' + v.date_target : ''}</span>
          ${v.notes ? '<br><span style="font-size:0.75rem;color:var(--text-dim);font-style:italic">' + v.notes + '</span>' : ''}
        </div>
        <span class="status-badge status-${v.status}">${v.status}</span>
      </div>`;
    });
    el.innerHTML = html;
  } else {
    el.innerHTML = '<div style="color:var(--text-dim);font-size:0.85rem;padding:12px">Sin venues en pipeline.</div>';
  }

  // Booking status chart
  const statuses = book.by_status || {};
  const statusLabels = Object.keys(statuses);
  if (statusLabels.length > 0) {
    const statusColors = {
      'identified': '#9ca3af', 'contacted': '#3b82f6',
      'negotiating': '#d97706', 'confirmed': '#16a34a', 'rejected': '#dc2626'
    };
    new Chart(document.getElementById('booking-chart'), {
      type: 'doughnut',
      data: {
        labels: statusLabels.map(s => s.charAt(0).toUpperCase() + s.slice(1)),
        datasets: [{ data: statusLabels.map(s => statuses[s]),
          backgroundColor: statusLabels.map(s => statusColors[s] || '#6b7280'),
          borderWidth: 0 }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: true, position: 'bottom' } }
      }
    });
  }
})();

// ‚îÄ‚îÄ Community Log ‚îÄ‚îÄ
(function() {
  const el = document.getElementById('community-log');
  if (!el) return;

  const log = DATA.community_log || [];
  const platformIcons = {'instagram':'üì∑','x':'ùïè','youtube':'‚ñ∂Ô∏è','tiktok':'‚ô™'};
  const typeColors = {'reply':'#3b82f6','like':'#ef4444','follow':'#16a34a','dm':'#9333ea','mention':'#d97706'};

  if (log.length > 0) {
    let html = '<div style="max-height:300px;overflow-y:auto;">';
    log.forEach(item => {
      const icon = platformIcons[item.platform] || 'üí¨';
      const typeColor = typeColors[item.type] || '#6b7280';
      html += `<div style="display:flex;align-items:flex-start;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);">
        <span style="font-size:1.1rem">${icon}</span>
        <div style="flex:1;min-width:0">
          <div style="display:flex;gap:6px;align-items:center;margin-bottom:2px">
            <span style="background:${typeColor}15;color:${typeColor};padding:1px 8px;border-radius:8px;font-size:0.7rem;font-weight:600">${item.type}</span>
            <span style="font-size:0.7rem;color:var(--text-dim)">${item.date}</span>
          </div>
          <div style="font-size:0.82rem;color:var(--text)">${item.description}</div>
        </div>
      </div>`;
    });
    html += '</div>';
    el.innerHTML = html;
  } else {
    el.innerHTML = '<div style="color:var(--text-dim);font-size:0.85rem;padding:12px">Sin interacciones registradas a√∫n. Dylan reportar√° despu√©s de las rondas de comunidad AM/PM.</div>';
  }
})();

// ‚îÄ‚îÄ Suggestions ‚îÄ‚îÄ
(function() {
  const el = document.getElementById('suggestions');
  if (!el) return;

  const suggestions = DATA.suggestions || [];
  const prioColors = {'alta':'#dc2626','media':'#d97706','info':'#3b82f6'};
  const prioIcons = {'alta':'üî¥','media':'üü°','info':'üîµ'};

  if (suggestions.length > 0) {
    let html = '';
    suggestions.forEach(s => {
      const icon = prioIcons[s.priority] || 'üí°';
      const color = prioColors[s.priority] || '#6b7280';
      html += `<div style="display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);">
        <span>${icon}</span>
        <div style="flex:1">
          <div style="font-size:0.75rem;font-weight:600;color:${color};text-transform:uppercase;letter-spacing:0.5px;margin-bottom:2px">${s.area}</div>
          <div style="font-size:0.85rem">${s.text}</div>
        </div>
      </div>`;
    });
    el.innerHTML = html;
  } else {
    el.innerHTML = '<div style="color:var(--text-dim);font-size:0.85rem;padding:12px">Sin sugerencias. Todo en orden.</div>';
  }
})();

</script>
</body>
</html>