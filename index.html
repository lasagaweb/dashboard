<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Saga Vuelve ‚Äî Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<style>
:root {
  --bg: #f4f5f7;
  --surface: #ffffff;
  --surface-2: #eef0f3;
  --border: #dde0e6;
  --text: #1a1d23;
  --text-dim: #6b7280;
  --accent: #d97706;
  --accent-glow: rgba(217, 119, 6, 0.1);
  --green: #16a34a;
  --red: #dc2626;
  --blue: #2563eb;
  --purple: #9333ea;
  --pink: #db2777;
  --ig: #C13584;
  --yt: #CC0000;
  --sp: #1DB954;
  --em: #2563eb;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  line-height: 1.5;
}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
  position: relative;
  padding: 40px 24px 32px;
  text-align: center;
  overflow: hidden;
  border-bottom: 1px solid var(--border);
}
.hero::before {
  content: '';
  position: absolute;
  top: -50%; left: -25%; width: 150%; height: 200%;
  background: radial-gradient(ellipse at 50% 0%, rgba(217,119,6,0.06) 0%, transparent 60%);
  pointer-events: none;
}
.hero-title {
  font-family: 'Sora', sans-serif;
  font-size: clamp(1.6rem, 5vw, 2.4rem);
  font-weight: 800;
  letter-spacing: -0.03em;
  background: linear-gradient(135deg, #d97706, #ea580c, #dc2626);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}
.hero-sub {
  font-family: 'Sora', sans-serif;
  color: var(--text-dim);
  font-size: 0.85rem;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}
.countdown {
  display: inline-flex;
  align-items: baseline;
  gap: 6px;
  margin-top: 16px;
  padding: 10px 24px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 100px;
}
.countdown-num {
  font-family: 'Sora', sans-serif;
  font-size: 2rem;
  font-weight: 700;
  color: var(--accent);
}
.countdown-label {
  font-size: 0.8rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px 16px;
}
.grid {
  display: grid;
  gap: 16px;
  margin-bottom: 24px;
}
.grid-4 { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
.grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
.grid-3 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }

/* ‚îÄ‚îÄ KPI CARDS ‚îÄ‚îÄ */
.kpi {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.kpi::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: var(--accent);
  opacity: 0.5;
}
.kpi-label {
  font-size: 0.7rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 6px;
  text-align: center;
}
.kpi-value {
  font-family: 'Sora', sans-serif;
  font-size: 1.5rem;
  font-weight: 700;
  letter-spacing: -0.02em;
  text-align: center;
}
.kpi-change {
  font-size: 0.75rem;
  margin-top: 4px;
}
.kpi-change.pos { color: var(--green); }
.kpi-change.neg { color: var(--red); }
.kpi-change.neutral { color: var(--text-dim); }

/* ‚îÄ‚îÄ PLATFORM TEAROFF TABS ‚îÄ‚îÄ */
.tearoff {
  display: flex;
  gap: 3px;
  margin-top: 14px;
  margin-left: -16px;
  margin-right: -16px;
  margin-bottom: -16px;
}
.tearoff-tab {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 4px 10px;
  border-top: 2px dashed var(--border);
  position: relative;
  cursor: default;
  transition: background 0.2s;
}
.tearoff-tab:hover {
  background: rgba(0,0,0,0.02);
}
.tearoff-tab:first-child {
  border-bottom-left-radius: 11px;
}
.tearoff-tab:last-child {
  border-bottom-right-radius: 11px;
}
.tearoff-color {
  width: 100%;
  height: 7px;
  border-radius: 3px;
  margin-bottom: 6px;
}
.tearoff-val {
  font-family: 'Sora', sans-serif;
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--text);
  line-height: 1;
}
.tearoff-name {
  font-size: 0.6rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-top: 3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}
.kpi-detail {
  font-size: 0.65rem;
  color: var(--text-dim);
  margin-top: 6px;
  line-height: 1.3;
  letter-spacing: 0.02em;
}

/* ‚îÄ‚îÄ SECTION ‚îÄ‚îÄ */
.section {
  margin-bottom: 32px;
}
.section-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}
.section-icon {
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
  flex-shrink: 0;
}
.section-icon.ig { background: rgba(225,48,108,0.15); }
.section-icon.em { background: rgba(59,130,246,0.15); }
.section-icon.yt { background: rgba(255,0,0,0.12); }
.section-icon.sp { background: rgba(29,185,84,0.15); }
.section-icon.x { background: rgba(0,0,0,0.08); }
.section-title {
  font-family: 'Sora', sans-serif;
  font-size: 1.1rem;
  font-weight: 600;
  letter-spacing: -0.01em;
}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.card-title {
  font-family: 'Sora', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 12px;
}

/* ‚îÄ‚îÄ METRICS ROW ‚îÄ‚îÄ */
.metric-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
}
.metric-row:last-child { border-bottom: none; }
.metric-name { font-size: 0.85rem; color: var(--text-dim); }
.metric-val {
  font-family: 'Sora', sans-serif;
  font-weight: 600;
  font-size: 0.95rem;
}

/* ‚îÄ‚îÄ CHART ‚îÄ‚îÄ */
.chart-wrap {
  position: relative;
  height: 200px;
  margin-top: 8px;
}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}
.data-table th {
  text-align: left;
  color: var(--text-dim);
  font-weight: 500;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: 8px 12px;
  border-bottom: 1px solid var(--border);
}
.data-table td {
  padding: 8px 12px;
  border-bottom: 1px solid var(--border);
}
.data-table tr:last-child td { border-bottom: none; }

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.progress {
  width: 100%;
  height: 6px;
  background: var(--surface-2);
  border-radius: 3px;
  overflow: hidden;
  margin-top: 8px;
}
.progress-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.5s ease;
}

/* ‚îÄ‚îÄ ALERT ‚îÄ‚îÄ */
.alert {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  background: rgba(220,38,38,0.06);
  border: 1px solid rgba(220,38,38,0.2);
  border-radius: 8px;
  font-size: 0.85rem;
  color: #991b1b;
  margin-bottom: 12px;
}

/* ‚îÄ‚îÄ TAG ‚îÄ‚îÄ */
.tag {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.tag-reel { background: rgba(147,51,234,0.1); color: #7c3aed; }
.tag-image { background: rgba(37,99,235,0.1); color: #1d4ed8; }
.tag-video { background: rgba(217,119,6,0.1); color: #b45309; }
.tag-short { background: rgba(219,39,119,0.1); color: #be185d; }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.footer {
  text-align: center;
  padding: 24px;
  color: var(--text-dim);
  font-size: 0.75rem;
  border-top: 1px solid var(--border);
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 640px) {
  .grid-4 { grid-template-columns: repeat(2, 1fr); }
  .grid-2, .grid-3 { grid-template-columns: 1fr; }
  .kpi-value { font-size: 1.2rem; }
  .container { padding: 16px 12px; }
}
</style>
</head>
<body>

<div class="hero">
  <div class="hero-title">LA SAGA VUELVE</div>
  <div class="hero-sub">Dashboard de Campa√±a ¬∑ Actualizado 19/02/2026 12:35</div>
</div>

<div class="container">

<!-- ‚ïê‚ïê‚ïê OVERVIEW KPIs ‚ïê‚ïê‚ïê -->
<div class="grid grid-4" id="overview-kpis"></div>

<!-- ‚ïê‚ïê‚ïê INSTAGRAM ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon ig">üì∑</div>
    <div class="section-title">Instagram</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">M√©tricas del Per√≠odo</div>
      <div id="ig-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n de Followers</div>
      <div class="chart-wrap"><canvas id="ig-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê YOUTUBE ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon yt">‚ñ∂Ô∏è</div>
    <div class="section-title">YouTube</div>
  </div>
  <div id="yt-alerts"></div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">M√©tricas del Per√≠odo</div>
      <div id="yt-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Views Diarias (30d)</div>
      <div class="chart-wrap"><canvas id="yt-chart"></canvas></div>
    </div>
  </div>
  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <div class="card-title">Top Videos</div>
      <div id="yt-top-videos"></div>
    </div>
    <div class="card">
      <div class="card-title">Fuentes de Tr√°fico (30d)</div>
      <div class="chart-wrap" style="height:220px"><canvas id="yt-traffic-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SPOTIFY ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon sp">üéµ</div>
    <div class="section-title">Spotify</div>
  </div>
  <div id="sp-alerts"></div>
  <div class="grid grid-3">
    <div class="card">
      <div class="card-title">M√©tricas Actuales</div>
      <div id="sp-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Top Tracks</div>
      <div id="sp-tracks"></div>
    </div>
    <div class="card">
      <div class="card-title">Audiencia por Pa√≠s</div>
      <div id="sp-locations"></div>
    </div>
  </div>
  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <div class="card-title">Demographics</div>
      <div class="chart-wrap" style="height:220px"><canvas id="sp-demo-chart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n Listeners</div>
      <div class="chart-wrap"><canvas id="sp-trend-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê EMAIL ‚ïê‚ïê‚ïê -->
<div class="section">
  <div class="section-header">
    <div class="section-icon em">üìß</div>
    <div class="section-title">Email Marketing</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Estado de la Lista</div>
      <div id="em-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n de Suscriptores</div>
      <div class="chart-wrap"><canvas id="em-chart"></canvas></div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-header">
    <div class="section-icon x">ùïè</div>
    <div class="section-title">X / Twitter</div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">M√©tricas de Cuenta</div>
      <div id="x-metrics"></div>
    </div>
    <div class="card">
      <div class="card-title">Evoluci√≥n Followers</div>
      <div class="chart-wrap"><canvas id="x-chart"></canvas></div>
    </div>
  </div>
  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">Top Posts</div>
      <div id="x-posts"></div>
    </div>
    <div class="card">
      <div class="card-title">Engagement por Post</div>
      <div class="chart-wrap"><canvas id="x-eng-chart"></canvas></div>
    </div>
  </div>
</div>

</div><!-- container -->

<div class="footer">
  La Saga Vuelve ¬∑ Dashboard generado autom√°ticamente ¬∑ 19/02/2026 12:35
</div>

<script>
const DATA = {"generated_at": "2026-02-19T12:35:08.622645", "days_to_show": 56, "period_days": 7, "instagram": {"last_date": "2026-02-18", "followers": 3566, "reach": 3319, "accounts_engaged": 314, "period_posts": 2, "period_reach": 5239, "period_engagement": 644, "top_post": {"date": "2026-02-12", "type": "reel", "caption": "En esta √©poca, ser felices es un privilegio\n\nNos juntamos, tocamos, nos re√≠mos. ", "reach": 2711}, "trend": [{"date": "2026-02-18", "followers": 3566, "reach": 3319}], "post_types": [{"type": "reel", "posts": 2, "avg_reach": 2620.0, "avg_engagement": 322.0}]}, "email": {"last_date": "2026-02-18", "total_subs": 1635, "period_gained": 0, "period_lost": 3, "campaigns": [{"name": "Bienvenida a la lista", "sent": 503, "open_pct": 59.8, "click_pct": 20.9, "sent_at": "2026-02-13T12:21:59+00:00"}], "last_campaign": {"name": "Bienvenida a la lista", "sent": 503, "open_pct": 59.8, "click_pct": 20.9, "sent_at": "2026-02-13T12:21:59+00:00"}, "avg_open_pct": 59.8, "avg_click_pct": 20.9, "total_campaigns": 1, "trend": [{"date": "2026-02-18", "subs": 1635}]}, "youtube": {"last_date": "2026-02-18", "subscribers": 3720, "total_views": 1543200, "videos_count": 38, "period_views": 1061, "period_likes": 18, "period_shares": 9, "period_watch_min": 2569.0, "period_subs_net": 5, "unreplied_comments": 100, "top_traffic_source": "PLAYLIST", "top_traffic_views": 2740, "traffic_sources": [{"source": "PLAYLIST", "views": 2740}, {"source": "YT_SEARCH", "views": 927}, {"source": "SUBSCRIBER", "views": 793}, {"source": "RELATED_VIDEO", "views": 363}, {"source": "NO_LINK_OTHER", "views": 208}, {"source": "YT_OTHER_PAGE", "views": 174}, {"source": "EXT_URL", "views": 158}, {"source": "YT_CHANNEL", "views": 123}, {"source": "SHORTS", "views": 107}, {"source": "NOTIFICATION", "views": 19}, {"source": "SHORTS_CONTENT_LINKS", "views": 2}, {"source": "END_SCREEN", "views": 1}], "top_videos": [{"title": "LA SAGA -  \"Color\" - (Video Oficial)", "views": 498560, "likes": 2221, "type": "Video"}, {"title": "LA SAGA - ONCE", "views": 465209, "likes": 2320, "type": "Video"}, {"title": "\"Errante\" (La Saga - \"INTIMO\")", "views": 161405, "likes": 696, "type": "Video"}, {"title": "La Saga - Yo te quiero (Video Oficial)", "views": 115952, "likes": 689, "type": "Video"}, {"title": "La Saga - Vos  (video oficial)", "views": 106267, "likes": 866, "type": "Video"}], "trend": [{"date": "2026-01-20", "views": 141, "likes": 2, "net_subs": 0}, {"date": "2026-01-21", "views": 180, "likes": 4, "net_subs": 1}, {"date": "2026-01-22", "views": 196, "likes": 1, "net_subs": 3}, {"date": "2026-01-23", "views": 205, "likes": 1, "net_subs": 0}, {"date": "2026-01-24", "views": 210, "likes": 1, "net_subs": 0}, {"date": "2026-01-25", "views": 144, "likes": 2, "net_subs": 0}, {"date": "2026-01-26", "views": 145, "likes": -1, "net_subs": 0}, {"date": "2026-01-27", "views": 178, "likes": 6, "net_subs": 1}, {"date": "2026-01-28", "views": 209, "likes": 1, "net_subs": 0}, {"date": "2026-01-29", "views": 218, "likes": 3, "net_subs": 0}, {"date": "2026-01-30", "views": 275, "likes": -1, "net_subs": 0}, {"date": "2026-01-31", "views": 232, "likes": 0, "net_subs": 0}, {"date": "2026-02-01", "views": 129, "likes": 0, "net_subs": 0}, {"date": "2026-02-02", "views": 201, "likes": 2, "net_subs": 0}, {"date": "2026-02-03", "views": 177, "likes": -1, "net_subs": -1}, {"date": "2026-02-04", "views": 267, "likes": 4, "net_subs": 1}, {"date": "2026-02-05", "views": 285, "likes": 0, "net_subs": 0}, {"date": "2026-02-06", "views": 186, "likes": 1, "net_subs": 0}, {"date": "2026-02-07", "views": 190, "likes": 0, "net_subs": 2}, {"date": "2026-02-08", "views": 119, "likes": 1, "net_subs": 1}, {"date": "2026-02-09", "views": 149, "likes": 1, "net_subs": -1}, {"date": "2026-02-10", "views": 178, "likes": 0, "net_subs": 0}, {"date": "2026-02-11", "views": 208, "likes": 1, "net_subs": 0}, {"date": "2026-02-12", "views": 221, "likes": 1, "net_subs": 0}, {"date": "2026-02-13", "views": 308, "likes": 2, "net_subs": 2}, {"date": "2026-02-14", "views": 211, "likes": 1, "net_subs": 1}, {"date": "2026-02-15", "views": 321, "likes": 14, "net_subs": 2}]}, "spotify": {"last_date": "2026-02-18", "monthly_listeners": 21909, "streams_28d": 100745, "followers": 11261, "super_listeners": 422, "saves": 922, "playlist_adds": 1008, "top_tracks": [], "demographics": [{"dim": "age", "value": "35-44", "pct": 37.0}, {"dim": "age", "value": "25-34", "pct": 32.0}, {"dim": "age", "value": "45-54", "pct": 18.0}, {"dim": "age", "value": "18-24", "pct": 6.0}, {"dim": "age", "value": "<18", "pct": 0.0}, {"dim": "gender", "value": "male", "pct": 63.0}, {"dim": "gender", "value": "female", "pct": 33.0}, {"dim": "gender", "value": "not_specified", "pct": 3.0}, {"dim": "gender", "value": "non-binary", "pct": 1.0}], "locations": [{"name": "Uruguay", "listeners": 15219}, {"name": "Argentina", "listeners": 4301}, {"name": "Spain", "listeners": 629}, {"name": "Mexico", "listeners": 421}, {"name": "Brazil", "listeners": 271}], "days_since_collection": 1, "trend": [{"date": "2026-02-18", "listeners": 21909, "streams": 100745, "followers": 11261}]}, "x": {"top_posts": [], "trend": []}, "financials": {"total_expenses": 0, "total_income": 0, "balance": 0}, "show": {"status": "sin registrar", "venue": null, "capacity": null, "tickets_sold": 0}, "kpi_history": [{"date": "2026-02-18", "total_followers": 18547, "total_reach": 6508, "total_engagement": 675, "email_list_size": 1635, "tickets_sold_total": 0}]};

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function fmt(n) {
  if (n == null) return 'N/A';
  if (Math.abs(n) >= 1e6) return (n/1e6).toFixed(1) + 'M';
  if (Math.abs(n) >= 1e3) return (n/1e3).toFixed(1) + 'K';
  return n.toLocaleString('es-UY');
}
function fmtChg(val, pct) {
  if (val == null) return '';
  const sign = val >= 0 ? '+' : '';
  let s = sign + val;
  if (pct != null) s += ' (' + sign + pct + '%)';
  return s;
}
function chgClass(val) {
  if (val == null || val === 0) return 'neutral';
  return val > 0 ? 'pos' : 'neg';
}
function shortDate(d) {
  const parts = d.split('-');
  return parts[2] + '/' + parts[1];
}

// ‚îÄ‚îÄ Chart defaults ‚îÄ‚îÄ
Chart.defaults.color = '#6b7280';
Chart.defaults.borderColor = 'rgba(0,0,0,0.06)';
Chart.defaults.font.family = "'DM Sans', sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.plugins.legend.display = false;

function lineChart(id, labels, datasets, opts) {
  return new Chart(document.getElementById(id), {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { intersect: false, mode: 'index' },
      scales: {
        x: { grid: { display: false }, ticks: { maxTicksLimit: 8 } },
        y: { grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { callback: v => fmt(v) } }
      },
      plugins: {
        tooltip: {
          backgroundColor: '#ffffff',
          borderColor: '#dde0e6',
          borderWidth: 1,
          titleColor: '#1a1d23',
          bodyColor: '#6b7280',
          padding: 10
        }
      },
      ...opts
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ Overview KPIs ‚îÄ‚îÄ
(function() {
  const ig = DATA.instagram, em = DATA.email, yt = DATA.youtube, sp = DATA.spotify, xd = DATA.x;
  const igF = ig.followers||0, ytS = yt.subscribers||0, spF = sp.followers||0, emS = em.total_subs||0, xF = xd.followers||0;
  const totalFollowers = igF + ytS + spF + xF;
  const totalAudience = totalFollowers + emS;
  const igR = ig.period_reach||0, ytV = yt.period_views||0;
  const totalReach = igR + ytV;
  const igE = ig.period_engagement||0, ytE = (yt.period_likes||0) + (yt.period_shares||0);
  const totalEngagement = igE + ytE;

  const COLORS = {ig:'#C13584', yt:'#CC0000', sp:'#1DB954', em:'#2563eb', x:'#1a1d23'};

  function tabs(segments) {
    const active = segments.filter(s => s.val > 0).sort((a,b) => b.val - a.val);
    if (active.length === 0) return '';
    return `<div class="tearoff">${active.map(s =>
      `<div class="tearoff-tab">
        <div class="tearoff-color" style="background:${s.color}"></div>
        <div class="tearoff-val">${fmt(s.val)}</div>
        <div class="tearoff-name">${s.name}</div>
      </div>`
    ).join('')}</div>`;
  }

  const kpis = [
    { label: 'Audiencia Total', value: fmt(totalAudience),
      tearoff: tabs([
        {name:'Instagram', val:igF, color:COLORS.ig},
        {name:'YouTube', val:ytS, color:COLORS.yt},
        {name:'Spotify', val:spF, color:COLORS.sp},
        {name:'X', val:xF, color:COLORS.x},
        {name:'Email', val:emS, color:COLORS.em}
      ]) },
    { label: 'Followers', value: fmt(totalFollowers),
      tearoff: tabs([
        {name:'Instagram', val:igF, color:COLORS.ig},
        {name:'YouTube', val:ytS, color:COLORS.yt},
        {name:'Spotify', val:spF, color:COLORS.sp},
        {name:'X', val:xF, color:COLORS.x}
      ]) },
    { label: 'Reach (' + DATA.period_days + 'd)', value: fmt(totalReach),
      tearoff: tabs([
        {name:'Instagram', val:igR, color:COLORS.ig},
        {name:'YouTube', val:ytV, color:COLORS.yt}
      ]) },
    { label: 'Engagement (' + DATA.period_days + 'd)', value: fmt(totalEngagement),
      tearoff: tabs([
        {name:'Instagram', val:igE, color:COLORS.ig},
        {name:'YouTube', val:ytE, color:COLORS.yt}
      ]) }
  ];

  document.getElementById('overview-kpis').innerHTML = kpis.map(k => `
    <div class="kpi">
      <div class="kpi-label">${k.label}</div>
      <div class="kpi-value">${k.value}</div>
      ${k.tearoff}
    </div>
  `).join('');
})();

// ‚îÄ‚îÄ Instagram ‚îÄ‚îÄ
(function() {
  const ig = DATA.instagram;
  let rows = [
    ['Followers', fmt(ig.followers), fmtChg(ig.followers_change, ig.followers_pct), chgClass(ig.followers_change)],
    ['Posts (per√≠odo)', ig.period_posts || 0, '', ''],
    ['Reach', fmt(ig.period_reach), '', ''],
    ['Engagement', fmt(ig.period_engagement), '', ''],
  ];
  if (ig.top_post) {
    rows.push(['Top Post', `<span class="tag tag-${ig.top_post.type}">${ig.top_post.type}</span> ${fmt(ig.top_post.reach)} reach`, '', '']);
  }
  document.getElementById('ig-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  if (ig.trend && ig.trend.length > 1) {
    lineChart('ig-chart',
      ig.trend.map(t => shortDate(t.date)),
      [{ label: 'Followers', data: ig.trend.map(t => t.followers),
          borderColor: '#E1306C', backgroundColor: 'rgba(225,48,108,0.1)',
          fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }]
    );
  }
})();

// ‚îÄ‚îÄ Email ‚îÄ‚îÄ
(function() {
  const em = DATA.email;
  let rows = [
    ['Suscriptores', fmt(em.total_subs), fmtChg(em.subs_change, em.subs_pct), chgClass(em.subs_change)],
    ['Nuevos (per√≠odo)', '+' + (em.period_gained || 0), '', ''],
    ['Bajas (per√≠odo)', '-' + (em.period_lost || 0), '', em.period_lost > 0 ? 'neg' : ''],
  ];
  if (em.last_campaign) {
    const lc = em.last_campaign;
    rows.push(['√öltima campa√±a', lc.name, '', '']);
    rows.push(['Open Rate', lc.open_pct + '%', '', '']);
    rows.push(['Click Rate', lc.click_pct + '%', '', '']);
  }
  if (em.avg_open_pct != null) {
    rows.push(['Promedio Open Rate', em.avg_open_pct + '%', '', '']);
    rows.push(['Promedio Click Rate', em.avg_click_pct + '%', '', '']);
  }
  document.getElementById('em-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  if (em.trend && em.trend.length > 1) {
    lineChart('em-chart',
      em.trend.map(t => shortDate(t.date)),
      [{ label: 'Suscriptores', data: em.trend.map(t => t.subs),
          borderColor: '#3B82F6', backgroundColor: 'rgba(59,130,246,0.1)',
          fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }]
    );
  }
})();

// ‚îÄ‚îÄ YouTube ‚îÄ‚îÄ
(function() {
  const yt = DATA.youtube;

  // Alerts
  let alerts = '';
  if (yt.unreplied_comments > 0) {
    alerts += `<div class="alert">‚ö†Ô∏è ${yt.unreplied_comments} comentarios sin responder</div>`;
  }
  document.getElementById('yt-alerts').innerHTML = alerts;

  let rows = [
    ['Subscribers', fmt(yt.subscribers), fmtChg(yt.subs_change, yt.subs_pct), chgClass(yt.subs_change)],
    ['Views (per√≠odo)', fmt(yt.period_views), '', ''],
    ['Watch Time', fmt(yt.period_watch_min) + ' min', '', ''],
    ['Subs netos', fmtChg(yt.period_subs_net, null), '', chgClass(yt.period_subs_net)],
    ['Views totales', fmt(yt.total_views), '', ''],
  ];
  if (yt.top_traffic_source) {
    rows.push(['Traffic #1', yt.top_traffic_source, '', '']);
  }
  document.getElementById('yt-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  // Views trend
  if (yt.trend && yt.trend.length > 1) {
    lineChart('yt-chart',
      yt.trend.map(t => shortDate(t.date)),
      [{ label: 'Views', data: yt.trend.map(t => t.views),
          borderColor: '#FF0000', backgroundColor: 'rgba(255,0,0,0.08)',
          fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2 }]
    );
  }

  // Top videos
  if (yt.top_videos && yt.top_videos.length) {
    document.getElementById('yt-top-videos').innerHTML = `
      <table class="data-table">
        <thead><tr><th>Video</th><th>Views</th><th>Likes</th></tr></thead>
        <tbody>
          ${yt.top_videos.map(v => `
            <tr>
              <td><span class="tag tag-${v.type.toLowerCase()}">${v.type}</span> ${v.title.substring(0, 35)}</td>
              <td>${fmt(v.views)}</td>
              <td>${fmt(v.likes)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }

  // Traffic sources (doughnut)
  if (yt.traffic_sources && yt.traffic_sources.length) {
    const colors = ['#f59e0b','#3b82f6','#22c55e','#a855f7','#ec4899','#ef4444','#06b6d4','#84cc16'];
    new Chart(document.getElementById('yt-traffic-chart'), {
      type: 'doughnut',
      data: {
        labels: yt.traffic_sources.map(s => s.source),
        datasets: [{ data: yt.traffic_sources.map(s => s.views),
          backgroundColor: colors.slice(0, yt.traffic_sources.length),
          borderWidth: 0 }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: {
          legend: { display: true, position: 'right',
            labels: { boxWidth: 10, padding: 8, font: { size: 10 } } }
        }
      }
    });
  }
})();

// ‚îÄ‚îÄ Spotify ‚îÄ‚îÄ
(function() {
  const sp = DATA.spotify;

  // Alerts
  let alerts = '';
  if ((sp.days_since_collection || 0) > 8) {
    alerts += `<div class="alert">‚ö†Ô∏è √öltima recolecci√≥n hace ${sp.days_since_collection} d√≠as ‚Äî login requerido</div>`;
  }
  document.getElementById('sp-alerts').innerHTML = alerts;

  // Metrics
  let rows = [
    ['Monthly Listeners', fmt(sp.monthly_listeners), fmtChg(sp.listeners_change, sp.listeners_pct), chgClass(sp.listeners_change)],
    ['Streams (28d)', fmt(sp.streams_28d), fmtChg(sp.streams_change, null), chgClass(sp.streams_change)],
    ['Followers', fmt(sp.followers), '', ''],
    ['Super Listeners', sp.super_listeners || 'N/A', '', ''],
    ['Saves', fmt(sp.saves), '', ''],
    ['Playlist Adds', fmt(sp.playlist_adds), '', ''],
  ];
  document.getElementById('sp-metrics').innerHTML = rows.map(r => `
    <div class="metric-row">
      <span class="metric-name">${r[0]}</span>
      <span class="metric-val">${r[1]} <small class="kpi-change ${r[3]}">${r[2]}</small></span>
    </div>
  `).join('');

  // Top tracks
  if (sp.top_tracks && sp.top_tracks.length) {
    document.getElementById('sp-tracks').innerHTML = `
      <table class="data-table">
        <thead><tr><th>Track</th><th>Streams</th><th>Saves</th></tr></thead>
        <tbody>
          ${sp.top_tracks.slice(0, 8).map(t => `
            <tr>
              <td>${t.name.substring(0, 30)}</td>
              <td>${fmt(t.streams)}</td>
              <td>${fmt(t.saves)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }

  // Locations
  if (sp.locations && sp.locations.length) {
    document.getElementById('sp-locations').innerHTML = sp.locations.map((l, i) => `
      <div class="metric-row">
        <span class="metric-name">${l.name}</span>
        <span class="metric-val">${fmt(l.listeners)}</span>
      </div>
    `).join('');
  }

  // Demographics (bar chart)
  if (sp.demographics && sp.demographics.length) {
    const ageData = sp.demographics.filter(d => d.dim === 'age');
    if (ageData.length) {
      new Chart(document.getElementById('sp-demo-chart'), {
        type: 'bar',
        data: {
          labels: ageData.map(d => d.value),
          datasets: [{ label: '%', data: ageData.map(d => d.pct),
            backgroundColor: 'rgba(29,185,84,0.6)', borderRadius: 4, barPercentage: 0.7 }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: {
            x: { grid: { display: false } },
            y: { grid: { color: 'rgba(0,0,0,0.05)' },
              ticks: { callback: v => v + '%' } }
          }
        }
      });
    }
  }

  // Listeners trend
  if (sp.trend && sp.trend.length > 1) {
    lineChart('sp-trend-chart',
      sp.trend.map(t => shortDate(t.date)),
      [{ label: 'Monthly Listeners', data: sp.trend.map(t => t.listeners),
          borderColor: '#1DB954', backgroundColor: 'rgba(29,185,84,0.1)',
          fill: true, tension: 0.3, pointRadius: 2, borderWidth: 2 }]
    );
  }
})();

// ‚îÄ‚îÄ X / Twitter ‚îÄ‚îÄ
(function() {
  const xd = DATA.x;
  if (!xd || (!xd.followers && !xd.top_posts)) return;

  // Account metrics
  const rows = [];
  rows.push(['Followers', fmt(xd.followers || 0)]);
  if (xd.followers_prev != null) {
    const diff = (xd.followers||0) - xd.followers_prev;
    rows.push(['Cambio (per√≠odo)', `<span class="kpi-change ${chgClass(diff)}">${diff >= 0 ? '+' : ''}${diff}</span>`]);
  }
  rows.push(['Following', fmt(xd.following || 0)]);
  if (xd.last_date) rows.push(['√öltima actualizaci√≥n', xd.last_date]);

  const el = document.getElementById('x-metrics');
  if (el) {
    el.innerHTML = rows.map(r => `<div class="metric-row"><span>${r[0]}</span><strong>${r[1]}</strong></div>`).join('');
  }

  // Top posts table
  if (xd.top_posts && xd.top_posts.length > 0) {
    const postsEl = document.getElementById('x-posts');
    if (postsEl) {
      let html = '<table class="data-table"><tr><th>Post</th><th>‚ù§Ô∏è</th><th>üîÅ</th><th>üí¨</th></tr>';
      xd.top_posts.forEach(p => {
        html += `<tr><td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.text}</td><td>${fmt(p.likes)}</td><td>${fmt(p.retweets)}</td><td>${fmt(p.replies)}</td></tr>`;
      });
      html += '</table>';
      postsEl.innerHTML = html;
    }
  }

  // Followers trend
  if (xd.trend && xd.trend.length > 1) {
    lineChart('x-chart',
      xd.trend.map(t => shortDate(t.date)),
      [{ label: 'Followers', data: xd.trend.map(t => t.followers),
          borderColor: '#1a1d23', backgroundColor: 'rgba(26,29,35,0.08)',
          fill: true, tension: 0.3, pointRadius: 2, borderWidth: 2 }]
    );
  }

  // Engagement chart (likes + retweets + replies per post)
  if (xd.top_posts && xd.top_posts.length > 0) {
    new Chart(document.getElementById('x-eng-chart'), {
      type: 'bar',
      data: {
        labels: xd.top_posts.map(p => p.text.substring(0, 20) + '...'),
        datasets: [
          { label: 'Likes', data: xd.top_posts.map(p => p.likes), backgroundColor: '#ef4444' },
          { label: 'Retweets', data: xd.top_posts.map(p => p.retweets), backgroundColor: '#3b82f6' },
          { label: 'Replies', data: xd.top_posts.map(p => p.replies), backgroundColor: '#22c55e' }
        ]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: true, position: 'bottom' } },
        scales: {
          x: { stacked: true, grid: { display: false }, ticks: { display: false } },
          y: { stacked: true, grid: { color: 'rgba(0,0,0,0.05)' } }
        }
      }
    });
  }
})();

</script>
</body>
</html>